<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>เว็บพลุปีใหม่ 2025</title>
<style>
/* Global */
body, html {
  margin: 0;
  padding: 0;
  background: #000;
  overflow: hidden;
  font-family: sans-serif;
  color: #fff;
}

/* Controls */
#controls {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  background: rgba(0,0,0,0.5);
  padding: 12px 24px;
  border-radius: 12px;
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  justify-content: center;
}

/* Countdown */
#countdown {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-weight: bold;
  color: #fff;
  text-shadow: 0 0 20px #f00, 0 0 40px #ff0;
  z-index: 20;
  text-align: center;
  font-size: 3em;
}

/* Canvas */
canvas {
  display: block;
}

/* Buttons */
#controls button {
  cursor: pointer;
  font-size: 1em;
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  background: #222;
  color: #fff;
  transition: 0.2s;
}
#controls button:hover {
  background: #555;
}

/* Media Queries สำหรับมือถือและแท็บเล็ต */
@media (max-width: 1024px) {
  #countdown { font-size: 2.5em; }
  #controls { padding: 10px 20px; gap: 8px; }
  #controls button { font-size: 0.95em; padding: 7px 14px; }
}

@media (max-width: 768px) {
  #countdown { font-size: 2em; }
  #controls { flex-direction: column; top: 5px; padding: 8px 16px; }
  #controls button { width: 100%; font-size: 0.9em; padding: 8px 0; }
}

@media (max-width: 480px) {
  #countdown { font-size: 1.5em; text-shadow: 0 0 10px #f00, 0 0 20px #ff0; }
  #controls { top: 5px; padding: 6px 12px; }
  #controls button { font-size: 0.85em; padding: 6px 0; }
}
</style>
</head>
<body>
<div id="controls">
  <button id="toggleMode">Auto: ON</button>
  <button id="launchBtn">Launch Firework</button>
</div>
<div id="countdown"></div>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;

function rand(min,max){return Math.random()*(max-min)+min;}

// สร้าง AudioContext สำหรับมือถือ
let audioContext;
function playSound(url, volume=1){
  if(!audioContext){
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }
  fetch(url)
    .then(response => response.arrayBuffer())
    .then(data => audioContext.decodeAudioData(data))
    .then(buffer => {
      const source = audioContext.createBufferSource();
      source.buffer = buffer;
      const gainNode = audioContext.createGain();
      gainNode.gain.value = volume;
      source.connect(gainNode).connect(audioContext.destination);
      source.start(0);
    })
    .catch(err => console.log(err));
}

// Particle class
class Particle {
  constructor(x,y,angle,speed,color,life,gravity=false){
    this.x = x; this.y = y;
    this.vx = Math.cos(angle)*speed;
    this.vy = Math.sin(angle)*speed;
    this.color = color;
    this.life = life;
    this.alpha = 1;
    this.gravity = gravity;
    this.prevX = x;
    this.prevY = y;
    this.hue = parseInt(color.match(/\d+/));
  }
  update(){
    this.prevX = this.x;
    this.prevY = this.y;
    this.x += this.vx;
    this.y += this.vy;
    if(this.gravity) this.vy += 0.05;
    this.life -= 16;
    this.alpha = Math.max(0,this.life/1000);
    this.hue += 2;
  }
  draw(ctx){
    ctx.save();
    ctx.globalAlpha = this.alpha;
    ctx.strokeStyle = `hsl(${this.hue},100%,50%)`;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(this.prevX,this.prevY);
    ctx.lineTo(this.x,this.y);
    ctx.stroke();
    ctx.restore();
  }
}

// Firework class
class Firework {
  constructor(x,y,targetY,color,type){
    this.x = x; this.y = y; this.targetY = targetY;
    this.color = color; this.exploded = false;
    this.type = type;
  }
  update(){
    this.y -= 5;
    if(this.y <= this.targetY && !this.exploded){
      this.explode(); 
      this.exploded = true;
    }
  }
  draw(ctx){
    ctx.save();
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x,this.y,2,10);
    ctx.restore();
  }
  explode(){
    // เล่นเสียงด้วย AudioContext
    if(this.type==='heart') playSound('https://www.soundjay.com/mechanical/sounds/explosion-01.mp3',1.0);
    else if(this.type==='star') playSound('https://www.soundjay.com/mechanical/sounds/explosion-01.mp3',0.8);
    else playSound('https://www.soundjay.com/mechanical/sounds/explosion-01.mp3',0.6);

    if(this.type==='heart') explodeHeart(this.x,this.y,this.color);
    else if(this.type==='star') explodeStar(this.x,this.y,this.color);
    else explodeCircle(this.x,this.y,this.color);
  }
}

let fireworks = [], particles = [];
const maxParticles = 600;

function explodeCircle(x,y,color){
  for(let i=0;i<30;i++){
    if(particles.length >= maxParticles) break;
    let angle = rand(0,Math.PI*2);
    let speed = rand(1,4);
    particles.push(new Particle(x,y,angle,speed,color,rand(800,1500),true));
  }
}

function explodeHeart(x,y,color){
  for(let i=0;i<80;i++){
    if(particles.length >= maxParticles) break;
    let t = rand(0,Math.PI*2);
    let px = 16*Math.pow(Math.sin(t),3);
    let py = -(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
    particles.push(new Particle(x+px*4,y+py*4,rand(0,6.28),rand(1,3),color,rand(800,1500),true));
  }
}

function explodeStar(x,y,color){
  for(let i=0;i<60;i++){
    if(particles.length >= maxParticles) break;
    let angle = rand(0,Math.PI*2);
    let radius = rand(10,20);
    let px = Math.cos(angle)*radius;
    let py = Math.sin(angle)*radius;
    particles.push(new Particle(x+px,y+py,rand(0,6.28),rand(1,3),color,rand(800,1500),true));
  }
}

// Launch หลายจุด
function launchMultiple(count=3){
  for(let i=0;i<count;i++){
    launch();
  }
}

function launch(x=Math.random()*W,y=H){
  // เล่นเสียง Launch
  playSound('https://www.soundjay.com/mechanical/sounds/rocket-1.mp3',0.5);

  let typeRand = Math.random();
  let type = typeRand<0.25?'heart':(typeRand<0.5?'star':'circle');
  fireworks.push(new Firework(x,y,rand(H/4,H/2),`hsl(${rand(0,360)},100%,50%)`,type));
}

// Animate
function animate(){
  ctx.fillStyle='rgba(0,0,0,0.18)';
  ctx.fillRect(0,0,W,H);

  for(let i=fireworks.length-1;i>=0;i--){
    fireworks[i].update(); fireworks[i].draw(ctx);
    if(fireworks[i].exploded) fireworks.splice(i,1);
  }

  for(let i=particles.length-1;i>=0;i--){
    particles[i].update(); particles[i].draw(ctx);
    if(particles[i].life <= 0) particles.splice(i,1);
  }

  requestAnimationFrame(animate);
}

animate();

// Controls
const launchBtn = document.getElementById('launchBtn');
const toggleBtn = document.getElementById('toggleMode');

launchBtn.onclick = ()=>{
  if(!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
  launchMultiple(rand(2,4));
};

let auto = true;
toggleBtn.onclick = ()=>{
  auto = !auto;
  toggleBtn.textContent = `Auto: ${auto?"ON":"OFF"}`;
  if(!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
};

setInterval(()=>{ if(auto) launchMultiple(rand(1,3)); },2200);

// Countdown
function updateCountdown(){
  let now = new Date();
  let target = new Date('Jan 1, 2026 00:00:00');
  let diff = target - now;
  if(diff<=0){ document.getElementById('countdown').textContent='Happy New Year 2026!'; return; }
  let d=Math.floor(diff/86400000);
  let h=Math.floor((diff%86400000)/3600000);
  let m=Math.floor((diff%3600000)/60000);
  let s=Math.floor((diff%60000)/1000);
  document.getElementById('countdown').textContent=`${d}d ${h}h ${m}m ${s}s`;
}
setInterval(updateCountdown,1000);
updateCountdown();

// Responsive canvas
window.addEventListener('resize',()=>{
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
});
</script>
</body>
</html>
